# Stage 1: Build the Angular app
FROM node:20-alpine AS build
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build --configuration=production
# Note the path generated by Angular CLI: dist/your-app-name

# Stage 2: Serve with Nginx
FROM nginx:alpine

# *** Add this line here ***
# Copy the local 'nginx-custom.conf' file to overwrite the default NGINX config file
COPY ./nginx-custom.conf /etc/nginx/conf.d/default.conf 
# Remove Nginx's default index.html file so it doesn't interfere
RUN rm -rf /usr/share/nginx/html/*.
# Copy the entire build output folder to the Nginx serving directory
# Make sure 'your-app-name' is replaced with your actual Angular project name 
COPY --from=build ./ClientApp/dist/browser /usr/share/nginx/html

# Nginx runs automatically when the container starts
